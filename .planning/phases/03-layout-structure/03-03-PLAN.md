---
phase: 03-layout-structure
plan: 03
type: execute
domain: ui-design
---

<objective>
Set up section routing with smooth scroll behavior and intersection observers for active navigation highlighting.

Purpose: Implement scroll spy functionality to highlight active navigation link based on visible section.
Output: Working intersection observer system with active state tracking and smooth scrolling.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-setup/01-01-SUMMARY.md
@.planning/phases/01-foundation-setup/01-02-SUMMARY.md
@.planning/phases/01-foundation-setup/01-03-SUMMARY.md
@.planning/phases/02-theme-system/02-01-SUMMARY.md
@.planning/phases/02-theme-system/02-02-SUMMARY.md
@.planning/phases/03-layout-structure/03-01-SUMMARY.md
@.planning/phases/03-layout-structure/03-02-SUMMARY.md
@src/components/navigation.tsx
@src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create intersection observer hook</name>
  <files>src/hooks/use-active-section.ts</files>
  <action>
Create custom hook to track which section is currently visible using Intersection Observer API.

Create src/hooks/use-active-section.ts:
```tsx
import { useState, useEffect } from 'react';

export function useActiveSection(sectionIds: string[]) {
  const [activeSection, setActiveSection] = useState<string>('');

  useEffect(() => {
    const observers: IntersectionObserver[] = [];

    const handleIntersect = (entries: IntersectionObserverEntry[]) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          setActiveSection(entry.target.id);
        }
      });
    };

    sectionIds.forEach((id) => {
      const element = document.getElementById(id);
      if (element) {
        const observer = new IntersectionObserver(handleIntersect, {
          rootMargin: '-50% 0px -50% 0px', // Trigger when section is 50% visible
          threshold: 0,
        });
        observer.observe(element);
        observers.push(observer);
      }
    });

    return () => {
      observers.forEach((observer) => observer.disconnect());
    };
  }, [sectionIds]);

  return activeSection;
}
```

The hook:
- Takes array of section IDs
- Uses Intersection Observer API
- Triggers when section is 50% visible (rootMargin)
- Returns currently active section ID
- Cleans up observers on unmount
  </action>
  <verify>
- src/hooks/use-active-section.ts exists
- Hook accepts sectionIds array
- Hook returns active section string
- No TypeScript errors
  </verify>
  <done>
Intersection observer hook created
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement active state in navigation</name>
  <files>src/components/navigation.tsx</files>
  <action>
Integrate useActiveSection hook to highlight active navigation link.

Update src/components/navigation.tsx:
```tsx
import { ThemeToggle } from '@/components/theme-toggle';
import { Button } from '@/components/ui/button';
import {
  Sheet,
  SheetContent,
  SheetHeader,
  SheetTitle,
  SheetTrigger,
} from '@/components/ui/sheet';
import { Menu } from 'lucide-react';
import { useState, useEffect } from 'react';
import { useActiveSection } from '@/hooks/use-active-section';

export function Navigation() {
  const [open, setOpen] = useState(false);

  const sectionIds = ['hero', 'about', 'experience', 'skills', 'projects', 'contact'];
  const activeSection = useActiveSection(sectionIds);

  const scrollToSection = (id: string) => {
    const element = document.getElementById(id);
    if (element) {
      element.scrollIntoView({ behavior: 'smooth' });
      setOpen(false);
    }
  };

  const navItems = [
    { label: 'About', id: 'about' },
    { label: 'Experience', id: 'experience' },
    { label: 'Skills', id: 'skills' },
    { label: 'Projects', id: 'projects' },
    { label: 'Contact', id: 'contact' },
  ];

  return (
    <header className="sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
      <div className="container flex h-16 items-center justify-between">
        {/* Logo/Name */}
        <div
          className="flex items-center gap-2 font-bold text-xl cursor-pointer"
          onClick={() => scrollToSection('hero')}
        >
          <span className="text-primary">Rohan</span>
          <span>Patel</span>
        </div>

        {/* Desktop Navigation */}
        <nav className="hidden md:flex items-center gap-6">
          {navItems.map((item) => (
            <button
              key={item.id}
              onClick={() => scrollToSection(item.id)}
              className={`text-sm font-medium transition-colors relative ${
                activeSection === item.id
                  ? 'text-primary'
                  : 'hover:text-primary'
              }`}
            >
              {item.label}
              {activeSection === item.id && (
                <span className="absolute -bottom-[21px] left-0 right-0 h-0.5 bg-primary" />
              )}
            </button>
          ))}
        </nav>

        {/* Right Side Actions */}
        <div className="flex items-center gap-2">
          <ThemeToggle />

          {/* Mobile Menu Button */}
          <Sheet open={open} onOpenChange={setOpen}>
            <SheetTrigger asChild>
              <Button variant="ghost" size="icon" className="md:hidden">
                <Menu className="h-5 w-5" />
                <span className="sr-only">Toggle menu</span>
              </Button>
            </SheetTrigger>
            <SheetContent side="right">
              <SheetHeader>
                <SheetTitle>Navigation</SheetTitle>
              </SheetHeader>
              <nav className="flex flex-col gap-4 mt-8">
                {navItems.map((item) => (
                  <button
                    key={item.id}
                    onClick={() => scrollToSection(item.id)}
                    className={`text-lg font-medium transition-colors text-left relative ${
                      activeSection === item.id
                        ? 'text-primary'
                        : 'hover:text-primary'
                    }`}
                  >
                    {item.label}
                    {activeSection === item.id && (
                      <span className="absolute -left-2 top-1/2 -translate-y-1/2 w-1 h-6 bg-primary rounded-full" />
                    )}
                  </button>
                ))}
              </nav>
            </SheetContent>
          </Sheet>
        </div>
      </div>
    </header>
  );
}
```

Changes:
- Import useActiveSection hook
- Define sectionIds array
- Call hook to get activeSection
- Add active styling (text-primary) when section is active
- Add visual indicator (underline for desktop, left bar for mobile)
- Apply active state to both desktop and mobile navigation
  </action>
  <verify>
- Navigation highlights active section
- Desktop: Underline appears under active link
- Mobile: Left bar appears next to active link
- Active state changes as you scroll
- Smooth scroll still works
- No TypeScript errors
  </verify>
  <done>
Active navigation highlighting implemented
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Intersection observer system with active section tracking and visual indicators in navigation.
  </what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:5173

    Active section tracking:
    - Scroll down slowly through sections
    - Watch navigation links as you cross section boundaries (50% point)
    - Verify navigation link highlights when section becomes active
    - Verify underline appears on desktop
    - Scroll back up - verify highlights update correctly

    Visual indicators:
    - Desktop: Check for blue underline under active link
    - Mobile: Open menu, check for blue left bar next to active item
    - Verify indicators disappear when section not active

    Smooth scroll:
    - Click navigation link
    - Verify smooth scroll to section
    - Verify correct section becomes active after scroll completes

    Edge cases:
    - Scroll to bottom (Contact section)
    - Refresh page
    - Verify active section detected correctly
    - Test in both light and dark themes
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] useActiveSection hook created
- [ ] Navigation highlights active section
- [ ] Visual indicators working
- [ ] Smooth scroll maintained
- [ ] Active state updates correctly
- [ ] Works in both themes
</verification>

<success_criteria>
- All tasks completed
- Intersection observer functional
- Active tracking working
- Visual indicators clear
- **Phase 3 complete** - ready for Phase 4 (Hero Section)
</success_criteria>

<output>
After completion, create `.planning/phases/03-layout-structure/03-03-SUMMARY.md`:

# Phase 3 Plan 3: Set Up Section Routing Summary

**Intersection observer system with active section tracking, visual indicators, and smooth scroll behavior**

## Accomplishments
- Custom useActiveSection hook created
- Intersection Observer API implemented
- Active section highlighting in navigation
- Visual indicators (desktop underline, mobile left bar)
- Smooth scroll maintained
- Clean observer cleanup on unmount

## Files Created/Modified
- `src/hooks/use-active-section.ts` - Custom hook for section tracking
- `src/components/navigation.tsx` - Active state integration

## Decisions Made
- Intersection Observer instead of scroll event listener (better performance)
- 50% visibility threshold (rootMargin: -50% 0px -50% 0px)
- Text color change + visual indicator for active state
- Different indicators for desktop vs mobile (underline vs left bar)
- Clean up observers on unmount (prevent memory leaks)

## Deviations from Plan
None - plan executed as specified.

## Issues Encountered
None

## Next Step
**Phase 3 complete** - ready for Phase 4 (Hero Section)
</output>
